var CompanyFunctions={getCompanyUrl:function(a){if(a==null||a==""){return GetUrl("Company")}return GetUrl("Company")+a},onCollapseExpandWelcome:function(b){var a=$(".nocompany-welcome-content");if(a.length>0){if($(b).hasClass("dnl-pinned")){$(b).removeClass("dnl-pinned").addClass("unpinned");a.hide()}else{$(b).addClass("dnl-pinned").removeClass("unpinned");a.show()}}},leaveCurrentCompany:function(b,a){OpenDialogWindow(b,a,function(){CompanyFunctions.deleteCurrentCompanyConfirmed()})},deleteCurrentCompany:function(b,a){OpenDeleteDialogWindow(b,a,function(){CompanyFunctions.deleteCurrentCompanyConfirmed()})},deleteCurrentCompanyConfirmed:function(){Nutcache.Waitingwindow.Show();Nutcache.Ajax.TryAjaxCall({url:CompanyFunctions.getCompanyUrl("Delete"),contentType:"application/json; charset=utf-8",type:"POST",data:JSON.stringify({}),dataType:"json",success:function(a){Nutcache.Waitingwindow.Hide();if(!a.IsSaved){LoadMessagesSection(a.Messages,"#floating-message-window")}else{window.location=a.Content}},error:ManageAjaxError})},getCountrySettings:function(a,b){if(a==null||a==""){return}Nutcache.Ajax.TryAjaxCall({url:GetUrl("Lookup")+"GetCountrySettings",contentType:"application/x-www-form-urlencoded; charset=UTF-8",type:"GET",dataType:"json",data:{countryId:a},success:function(c){if(b){b(c)}},error:ManageAjaxError},true)}};CompanyPageFunctions={manageCountrySelection:function(b){if($("#EnableCurrency").length){var c=$("#EnableCurrency").val().toLowerCase()=="true";if(!c){return}}var a=b.sender.value();CompanyFunctions.getCountrySettings(a,function(d){$("#CompanyCurrencyId").data("kendoDropDownList").value(d.CurrentyID)})},getCountrySubdivisionFilterData:function(){return{countryId:$("#CompanyCountryId").val(),search:$("#CompanySubdivisionId-list span.k-list-filter .k-textbox").val()}},timeRounding_onChange:function(a){CompanyPageFunctions.manageTimeRoundingSelection()},manageTimeRoundingSelection:function(){$("#TimeRounding").data("kendoDropDownList").selectedIndex>0?$(".time-rounding-hours").show():$(".time-rounding-hours").hide()},currency_onDataBound:function(a){if(a.sender.element.hasClass("nutcache-combobox-disabled")){a.sender.enable(false)}},tabStripCompany_OnSelect:function(a){setTimeout("evaluateFloatingBottomAction();",100)},refreshCompanySettings:function(a){window.location=CompanyFunctions.getCompanyUrl("Settings")+"/"+a},saveSettings:function(){var b=$("#CompanySettingsContainer");var a=CompanyPageFunctions.getCompanyData(b);var d=$("#TimeTrackingType",b).prop("defaultValue");if(a.TimeTrackingType=="StartEnd"&&d=="Duration"){var e=$("#ChangeTimeTrackingTypeTitle").val();var c=$("#ChangeTimeTrackingTypeMessage").val();OpenDialogWindow(e,c,function(){CompanyPageFunctions.saveSettingsConfirmed(a)});return}CompanyPageFunctions.saveSettingsConfirmed(a)},saveSettingsConfirmed:function(a){Nutcache.Waitingwindow.Show();var b=$("#CompanySettingsContainer");Nutcache.Ajax.TryAjaxCall({url:CompanyFunctions.getCompanyUrl("UpdateSettings"),contentType:"application/json; charset=utf-8",type:"POST",data:JSON.stringify(a),dataType:"json",success:function(c){Nutcache.Waitingwindow.Hide();if(c.IsSaved){$("#TimeTrackingType",b).prop("defaultValue",$("#TimeTrackingType",b).val());$("#Version",b).val(c.Content.Version);$(".company-name-section .company-name").html(c.Content.Name);$("#timespanFormat").val(c.Content.TimeSpanFormat);$("#dateFormat").val(c.Content.DateFormat);$("#timeFormat").val(c.Content.TimeFormat)}else{if(c.IsRedirect){window.location=c.Content}else{}}LoadMessagesSection(c.Messages,"#floating-message-window")},error:ManageAjaxError})},getCompanyData:function(b){var a={CompanyId:$("#CompanyId",b).val(),Version:$("#Version",b).val(),Name:$("#Name",b).val(),Address:$("#Address",b).val(),City:$("#City",b).val(),PostalZipCode:$("#PostalZipCode",b).val(),CountryId:$("#CompanyCountryId",b).val(),SubdivisionId:$("#CompanySubdivisionId",b).val(),Email:$("#Email",b).val(),Phone:$("#Phone",b).val(),PhoneMobile:$("#PhoneMobile",b).val(),Fax:$("#Fax",b).val(),ActualSiteIdentifier:$("#ActualSiteIdentifier",b).val(),SiteIdentifier:$("#SiteIdentifier",b).val(),EnableCurrency:$("#EnableCurrency",b).val().toLowerCase()=="true",CurrencyId:$("#CompanyCurrencyId",b).val(),LegalNotice:$("#LegalNotice",b).val(),RegistrationInfo:$("#RegistrationInfo",b).val(),DefaultInvoicingNotes:$("#DefaultInvoicingNotes",b).val(),DefaultInvoicingTerms:$("#DefaultInvoicingTerms",b).val(),UseAutomaticNumbering:$("#UseAutomaticNumbering",b).is(":checked"),DateFormat:$("#DateFormat",b).val(),TimeSpanFormat:$("#TimeSpanFormat",b).val(),TimeRounding:$("#TimeRounding",b).val(),TimeRoundingMinutes:$("#TimeRoundingMinutes",b).val(),TimeTrackingType:$("#TimeTrackingType",b).val(),TimeFormat:$("#TimeFormat",b).val(),Presentation:$("#Presentation",b).val(),HasLogo:$("#HasLogo",b).val(),TimesheetPeriod:$("#TimesheetPeriod",b).val(),TimesheetInvoiceType:$("#TimesheetInvoiceType",b).val()};return a},showCompanyPresentationPreview:function(){var a=CompanyPageFunctions.getCompanyData($("#CompanySettingsContainer"));var b=window.open("","_blank");Nutcache.Ajax.TryAjaxCall({url:CompanyFunctions.getCompanyUrl("PrepareCompanyPresentationPreview"),contentType:"application/json; charset=utf-8",type:"POST",data:JSON.stringify(a),dataType:"json",success:function(c){if(c.IsSaved){var d=GetUrl("Home")+"Index";b.location=d}},error:ManageAjaxError})}};CompanyPopupFunctions={showCompanyPopup:function(b,d){var a=function(){CompanyPopupFunctions.manageTimeRoundingSelection();$("#Name").focus()};var c=function(f){CompanyPopupFunctions.saveCompany(f,d)};var e=CompanyFunctions.getCompanyUrl("GetView");PopupWindowFunctions.openPopupWindow(e,c,null,a)},saveCompany:function(c,d){var b=CompanyPopupFunctions.getCompanyData(c.wrapper);var a=(typeof b.Id=="undefined"||b.Id=="0")?"Create":"Edit";Nutcache.Ajax.TryAjaxCall({url:CompanyFunctions.getCompanyUrl(a),contentType:"application/json; charset=utf-8",type:"POST",data:JSON.stringify(b),dataType:"json",success:function(e){CompanyPopupFunctions.saveCompanySuccess(c,e,d)},error:ManageAjaxError})},saveCompanySuccess:function(b,a,c){if(a.IsSaved){b.close();window.location.href=a.Content}else{b.content(a.Content);CompanyPopupFunctions.manageTimeRoundingSelection()}LoadMessagesSection(a.Messages,"#floating-message-window")},getCompanyData:function(b){var a={Id:$("#ID",b).val(),Name:$("#Name",b).val(),Email:$("#Email",b).val(),Country:{ID:$("#OrganizationPopupCountryId",b).val()!=-1?$("#OrganizationPopupCountryId",b).val():null},SubDivision:{ID:$("#SubDivision_ID",b).val()!=-1?$("#SubDivision_ID",b).val():null},Currency:{ID:$("#OrganizationPopupCurrencyId",b).val()!=-1?$("#OrganizationPopupCurrencyId",b).val():null},dateFormat:$("#OrganizationPopupDateFormatId",b).val(),TimeFormat:$("#OrganizationPopupTimeFormatId",b).val(),TimeSpanFormat:$("#OrganizationPopupTimeSpanFormatId",b).val(),TimeRounding:$("#OrganizationPopupTimeRoundingId",b).val(),TimeRoundingMinutes:$("#TimeRoundingMinutes",b).val(),TimeTrackingType:$("#OrganizationPopupTimeTrackingTypeId",b).val(),Version:$("#Version",b).val(),TemporaryLogoFileKey:$("#company-edit-form-temp-logo",b).attr("data-temporaryFileKey"),UseAutomaticNumbering:$("#UseAutomaticNumbering",b).is(":checked")};return a},manageCountrySelectionPopup:function(b){var a=b.sender.value();if(a==null||a==""){return}CompanyFunctions.getCountrySettings(a,function(c){$("#OrganizationPopupCurrencyId").data("kendoDropDownList").value(c.CurrentyID);$("#OrganizationPopupDateFormatId").data("kendoDropDownList").select(c.DateFormat);$("#OrganizationPopupTimeFormatId").data("kendoDropDownList").select(c.TimeFormat)})},timeRounding_onChange:function(a){CompanyPopupFunctions.manageTimeRoundingSelection()},manageTimeRoundingSelection:function(){$("#OrganizationPopupTimeRoundingId").data("kendoDropDownList").selectedIndex>0?$(".time-rounding-hours").show():$(".time-rounding-hours").hide()}};CompanyRegisterFunctions={manageCountrySelection:function(b){var a=b.sender.value();CompanyFunctions.getCountrySettings(a,function(c){$("#Currency_ID").data("kendoDropDownList").value(c.CurrentyID);$("#DateFormat").data("kendoDropDownList").select(c.DateFormat);$("#TimeFormat").data("kendoDropDownList").select(c.TimeFormat)})},};function FormatLastActivityDate(){$("div.last-activity-info span").each(function(b){var d=$(this).html();var c=0;var a;if(!stringIsBlank(d)&&!isNaN(d)){c=parseInt(d)}if(c!=0){a=new Date(0);a.setUTCSeconds(c);$(this).html(Nutcache.Dates.ToDateTimeString(a))}else{$(this).html("")}$(this).parent().removeClass("hidden")})}function PopupCompanyListWindow(){var a=GetUrl("company")+"RenderCompanyList";Nutcache.Waitingwindow.Show();Nutcache.Ajax.TryAjaxCall({url:a,contentType:"application/json; charset=utf-8",type:"GET",dataType:"json",success:function(b){Nutcache.Waitingwindow.Hide();if(b.IsRedirect){ShowErrors(b)}else{var d=$("#popup-window");var c=d.data("kendoWindow");c.content(b.Content);c.title(b.Title);$(document).on("click",".k-overlay",function(){c.close()});c.center().open();FormatLastActivityDate()}},error:ManageAjaxError})}function OpenCompany(a){Nutcache.Waitingwindow.Show();window.location.href=CompanyFunctions.getCompanyUrl("Open")+"?id="+a}function PopupGatewayCurrenciesWindow(b,c,a){PopupWindow(b,"Company",c,a,null,"ShowGatewayCurrencies")}$(document).on("change","#PayPal_TestMode_Live",function(){$("#PayPal_Status").prop("checked",true)});$(document).on("change","#TwoCheckout_TestMode_Live",function(){$("#TwoCheckout_Status").prop("checked",true)});$(document).on("change","#AuthorizeNet_TestMode_Live",function(){$("#AuthorizeNet_Status").prop("checked",true)});$(".current-company-links").click(function(){Nutcache.Waitingwindow.Show()});function CleanCompanyLogo(a,b,c){OpenDialogWindow(c,a,"CompleteCleanCompanyLogo('"+b.replace(/'/g,"\\'")+"')")}function CompleteCleanCompanyLogo(a){Nutcache.Ajax.TryAjaxCall({url:GetUrl("FileManager")+"DeleteCompanyLogo",contentType:"application/json; charset=utf-8",type:"GET",dataType:"json",success:function(b){if(b.status=="ok"){window.location.href=window.location.href.split("#")[0]}else{if(b.status=="error"){ShowErrorMessages(a)}}},error:ManageAjaxError})}$(".nocompany-welcome-container .nocompany-welcome-pin-btn").click(function(){localStorage["nocompany-welcome-pin-btn"]=!$(this).hasClass("unpinned")?"1":"";CompanyFunctions.onCollapseExpandWelcome(this)});$(document).ready(function(){var a=localStorage["nocompany-welcome-pin-btn"];if(a){CompanyFunctions.onCollapseExpandWelcome($(".nocompany-welcome-container .nocompany-welcome-pin-btn"))}FormatLastActivityDate()});