var CustomerFunctions={getCustomerUrl:function(a){if(a==null||a==""){return GetUrl("Customer")}return GetUrl("Customer")+a},getCustomerId:function(){return $(".main-header-section").data("id")},actionEdit:function(a){window.location=CustomerFunctions.getCustomerUrl("Edit")+"/"+a.recordId},actionDelete:function(a){OpenDeleteDialogWindow(a.menuData.messages.deleteConfirmTitle,a.menuData.messages.deleteConfirmMessage,function(){CustomerFunctions.deleteCustomer(a.recordId,function(){window.location=CustomerFunctions.getCustomerUrl("Index")})})},actionDeleteFromIndex:function(a){OpenDeleteDialogWindow(a.menuData.messages.deleteConfirmTitle,a.menuData.messages.deleteConfirmMessage,function(){CustomerFunctions.deleteCustomer(a.recordId,function(){NutcacheGridFunctions.refreshGrids("#gridCustomers")})})},deleteCustomer:function(a,b){Nutcache.Ajax.TryAjaxCall({url:CustomerFunctions.getCustomerUrl("Delete"),contentType:"application/x-www-form-urlencoded; charset=UTF-8",type:"GET",dataType:"json",data:{id:a},success:function(c){if(c.IsSaved){if(b){b(c)}}LoadMessagesSection(c.Messages,"#floating-message-window")},error:ManageAjaxError})},customersIndexGrid_OnRecordSelected:function(a,b){var c=CustomerFunctions.getCustomerUrl("Edit")+"/"+a.ID;if(b.ctrlKey||b.metaKey){window.open(c,"_blank")}else{Nutcache.Waitingwindow.Show();window.location=c}},getCustomerSummary:function(a,b){Nutcache.Ajax.TryAjaxCall({url:CustomerFunctions.getCustomerUrl("GetSummary"),contentType:"application/json; charset=utf-8",type:"POST",data:JSON.stringify({customerId:a}),dataType:"json",success:function(c){if(c.IsSaved&&b){b(c.Content)}},error:ManageAjaxError})},refreshBubbleCounts:function(a){if((typeof a!="undefined")&&(a>0)){CustomerFunctions.getCustomerSummary(a,function(b){CustomerFunctions.refreshBubbleCount($("#tabProjects .bubble-count"),b.ProjectsCount);CustomerFunctions.refreshBubbleCount($("#tabEstimates .bubble-count"),b.EstimatesCount);CustomerFunctions.refreshBubbleCount($("#tabInvoices .bubble-count"),b.InvoicesCount);CustomerFunctions.refreshBubbleCount($("#tabPayments .bubble-count"),b.PaymentsCount);CustomerFunctions.refreshBubbleCount($("#tabOverdueInvoices .bubble-count"),b.OverdueInvoicesCount);CustomerFunctions.refreshBubbleCount($("#tabRecurringInvoices .bubble-count"),b.RecurringInvoicesCount);CustomerFunctions.refreshBubbleCount($("#tabAttachments .bubble-count"),b.AttachmentsCount);CustomerFunctions.refreshBubbleCount($("#tabNotes .bubble-count"),b.NotesCount)})}},refreshBubbleCount:function(b,a){if(a>0){b.show();b.text(a>99?"99+":a)}else{b.hide()}}};var CustomerPageFunctions={saveAndNew:function(a){CustomerPageFunctions.save(a,true)},discardAndNew:function(){GoogleAnalyticsFunctions.TrackEvent("link","create","CustomerFromPlusButton","0");window.location=CustomerFunctions.getCustomerUrl("Create")},save:function(e,d){var f=$("#uploadsInProgress");if(f.length&&f.val()!="0"){ShowErrorMessages($("#uploadsInProgressText").val());return}var c=CustomerFunctions.getCustomerId();var a=(typeof c=="undefined"||c=="0")?"Create":"Edit";var b=CustomerPageFunctions.getCustomerData();if(b==null){return}Nutcache.Waitingwindow.Show();Nutcache.Ajax.TryAjaxCall({url:CustomerFunctions.getCustomerUrl(a),contentType:"application/json; charset=utf-8",type:"POST",data:JSON.stringify(b),dataType:"json",success:function(g){CustomerPageFunctions.saveSuccess(g,e,d)},error:ManageAjaxError})},saveSuccess:function(a,c,b){if(a.IsRedirect){if(b){GoogleAnalyticsFunctions.TrackEvent("link","create","CustomerFromPlusButton","0");window.location=CustomerFunctions.getCustomerUrl("Create")}else{window.location=a.Content}return}Nutcache.Waitingwindow.Close();$("#TabInformationContainer").html(a.Content);if(a.IsSaved){if(c){c()}}LoadMessagesSection(a.Messages,"#floating-message-window")},newCustomer:function(){if(CustomerPageFunctions.isCustomerDirty()){var c=$("#HideDirtyConfirmationTitle").val();var b=$("#HideDirtyConfirmationMessage").val();var a=[{buttonClass:"nc-button nutcache-button ripplelink",onClickFunction:function(){CustomerPageFunctions.saveAndNew()},text:window.saveString},{buttonClass:"nc-button nutcache-button ripplelink",onClickFunction:function(){CustomerPageFunctions.discardAndNew()},text:window.discardString},{buttonClass:"nc-button nutcache-cancel-button ripplelink",onClickFunction:null,text:window.cancelString}];OpenDialogWindowWithButtons(c,b,a)}else{GoogleAnalyticsFunctions.TrackEvent("link","create","CustomerFromPlusButton","0");window.location=CustomerFunctions.getCustomerUrl("Create")}},getCustomerData:function(){var a=".customer-section-container";var b={Id:CustomerFunctions.getCustomerId(),Name:$("#Name",a).val(),Email:$("#Email",a).val(),Contact:$("#Contact",a).val(),Address:$("#Address",a).val(),City:$("#City",a).val(),PostalZipCode:$("#PostalZipCode",a).val(),Phone:$("#Phone",a).val(),PhoneMobile:$("#PhoneMobile",a).val(),LegalNotice:$("#LegalNotice",a).val(),CountryId:$("#Country_ID",a).val()!=-1?$("#Country_ID",a).val():null,SubDivisionId:$("#SubDivision_ID",a).val()!=-1?$("#SubDivision_ID",a).val():null,TaxId:$("#Tax_ID",a).val(),Status:$("#CustomerStatus",a).val(),Version:$("#Version",a).val(),CommunicationCultureCode:$("#CustomerCommunicationCultureCode",a).val()!=ID_UNDEFINED?$("#CustomerCommunicationCultureCode",a).val():null,QuickNotes:$("#QuickNotes",a).val()};return b},isCustomerDirty:function(){var b=document.getElementById("main");if(!b){return false}var a=Nutcache.ChangeDetection.FindChanges(b);return a.length>0},onAttachmentDeleteConfirmed:function(a){Nutcache.Ajax.TryAjaxCall({url:CustomerFunctions.getCustomerUrl("DeleteAttachment"),contentType:"application/json; charset=utf-8",type:"POST",dataType:"json",data:JSON.stringify({ID:a.data("id")}),success:function(b){if(b.IsSaved){$(".attachment-container[data-id="+a.data("id")+"]").remove();AttachmentFunctions.removeAttachmentConfirmed(a)}LoadMessagesSection(b.Messages,"#floating-message-window")},error:ManageAjaxError},true)}};var CustomerPopupFunctions={showPopupWindow:function(b,d,a){var e=CustomerFunctions.getCustomerUrl("GetView")+"?"+$.param({id:b});var c=PopupWindowFunctions.getPopupWindow("CustomerCreateEditPopup","ID",b);if(c!=null){PopupWindowFunctions.refreshPopupWindowContent(c,e,function(){CustomerPopupFunctions.setSuccessJsCallbackFunction(c.wrapper,d)})}else{PopupWindowFunctions.openPopupWindow(e,function(f){CustomerPopupFunctions.save(f,d)},a,function(f){CustomerPopupFunctions.setSuccessJsCallbackFunction(f.wrapper,d)})}},save:function(d,e){var c=$("#ID",d.wrapper).val();var a=(typeof c=="undefined"||c=="0"||c=="")?"CreateFromPopup":"EditFromPopup";var b=CustomerPopupFunctions.getData(d.wrapper);if(b!=null){var f=CustomerFunctions.getCustomerUrl(a);Nutcache.Ajax.TryAjaxCall({url:f,contentType:"application/json; charset=utf-8",type:"POST",data:JSON.stringify(b),dataType:"json",success:function(g){CustomerPopupFunctions.saveSuccess(d,g,e)},error:ManageAjaxError})}},saveSuccess:function(b,a,c){if(a.IsRedirect){b.close()}else{if(a.IsSaved){b.close();if(c){c(a.Content)}}else{b.content(a.Content)}}LoadMessagesSection(a.Messages,"#floating-message-window")},getData:function(a){var b={Id:$("#ID",a).val(),Name:$("#Name",a).val(),Email:$("#Email",a).val(),Contact:$("#Contact",a).val(),Address:$("#Address",a).val(),City:$("#City",a).val(),PostalZipCode:$("#PostalZipCode",a).val(),Phone:$("#Phone",a).val(),PhoneMobile:$("#PhoneMobile",a).val(),LegalNotice:$("#LegalNotice",a).val(),CountryId:$("#Country_ID",a).val()!=-1?$("#PopupCountryId",a).val():null,SubDivisionId:$("#SubDivision_ID",a).val()!=-1?$("#PopupSubDivisionId",a).val():null,TaxId:$("#PopupTaxId",a).val(),Version:$("#Version",a).val(),CommunicationCultureCode:$("#PopupCommunicationCultureCode",a).val()!=ID_UNDEFINED?$("#PopupCommunicationCultureCode",a).val():null,SuccessJsCallbackFunction:$("#SuccessJsCallbackFunction",a).val()};return b},setSuccessJsCallbackFunction:function(a,b){$("#SuccessJsCallbackFunction",a).val(String(b).replace(/"/g,"'"))},getCustomerInformations:function(a,b){if(typeof a==="undefined"||a==null||a==""){return}Nutcache.Ajax.TryAjaxCall({url:CustomerFunctions.getCustomerUrl("GetCustomer"),contentType:"application/x-www-form-urlencoded; charset=UTF-8",type:"GET",dataType:"json",data:{id:a},success:function(c){if(b){b(c)}},error:ManageAjaxError})},getCountrySubdivisionFilterData:function(){return{countryId:$("#PopupCountryId").val(),search:$("#PopupSubdivisionId-list span.k-list-filter .k-textbox").val()}},taxDropDownList_Change:function(b){var f=function(){};var d=function(e){Nutcache.KendoUI.dropDownListWithAddNewSuccess(e,b.sender,f)};var c=function(){return Nutcache.KendoUI.dropDownListWithAddNewCancel(b.sender)};var a=function(){TaxFunctions.showTaxPopupWindow(0,d,c)};var g=f;Nutcache.KendoUI.dropDownListWithAddNew_onChange(b.sender,a,g)}};