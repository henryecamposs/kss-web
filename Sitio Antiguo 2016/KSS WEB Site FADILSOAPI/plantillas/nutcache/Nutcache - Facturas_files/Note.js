var NoteFunctions={observers:new Array(),addObserver:function(a){NoteFunctions.observers.push(a)},notifyObservers:function(){if(NoteFunctions.observers!=null&&NoteFunctions.observers.length>0){$.each(NoteFunctions.observers,function(){this()})}},getNoteUrl:function(a){return GetUrl("Note")+a},getNoteContainer:function(a){return $(".note-container[data-id="+a+"]","#NoteListContainer")},getCurrentCreateUrl:function(){return $("#NoteListContainer").data("create-url")},getCurrentEditUrl:function(){return $("#NoteListContainer").data("edit-url")},getCurrentDeleteUrl:function(){return $("#NoteListContainer").data("delete-url")},isCurrentSortDescending:function(){return !$("#SortOrderCheckbox input[type=checkbox]").is(":checked")},formatAllNoteDateTime:function(){$(".note-container","#NoteListContainer").each(function(b,a){NoteFunctions.formatNoteDateTime($(a))})},formatNoteDateTime:function(d){var c=Nutcache.Dates.dateTimeFormatString;var a=d.data("creation-date");var b=d.find(".date").text();d.find(".date").text(b.replace("##LOCALDATETIME##",Nutcache.Dates.ConvertUTCDateTimeToLocalDateTime(a,c)))},replyToNote:function(c){InlineEditingTextareaFunctions.cancel("#NoteListContainer");var a=$(".child-notes[data-id="+c+"]","#NoteListContainer");var b=$(".note-container.new-item","#NoteListContainer");var d=NoteFunctions.getCurrentCreateUrl()+"&parentNoteId="+c;if(NoteFunctions.isCurrentSortDescending()){a.prepend(b)}else{a.append(b)}$("#AddNoteLink",b).data("url",d);$("#AddNoteLink",b).trigger("click")},moveNewElementToInitialPosition:function(){var a=$(".note-container.new-item","#NoteListContainer");$("#AddNoteLink",a).data("url",NoteFunctions.getCurrentCreateUrl());if(NoteFunctions.isCurrentSortDescending()){$("#NoteListContainer").prepend(a)}else{$("#NoteListContainer").append(a)}},deleteNote:function(b){var c=$("#NoteListContainer").data("confirmation-title");var a=$("#NoteListContainer").data("delete-message");OpenDeleteDialogWindow(c,a,function(){NoteFunctions.deleteNoteConfirmed(b)})},deleteNoteConfirmed:function(a){InlineEditingRichTextAreaFunctions.cancel("#NoteListContainer");var b=NoteFunctions.getCurrentDeleteUrl();Nutcache.Ajax.TryAjaxCall({url:b,contentType:"application/json; charset=utf-8",type:"POST",data:JSON.stringify({id:a}),dataType:"json",success:function(c){if(c.IsSaved){NoteFunctions.removeNoteFromList(a);NoteFunctions.notifyObservers()}else{LoadMessagesSection(c.Messages,"#floating-message-window")}},})},removeNoteFromList:function(a){NoteFunctions.getNoteContainer(a).remove();$(".child-notes[data-id="+a+"]","#NoteListContainer").remove()},addNoteToList:function(b,e,f){var a=$("#NoteListContainer");if(f!=undefined&&f>0){a=$(".child-notes[data-id="+f+"]","#NoteListContainer")}if(NoteFunctions.getNoteContainer(e).length){return}if(NoteFunctions.isCurrentSortDescending()){var c=$("> .note-container:not(.new-item):first",a);if(c.length){$(b).insertBefore(c)}else{a.append(b)}}else{var d=$("> .child-notes:last",a);if(d.length){$(b).insertAfter(d)}else{a.prepend(b)}}NoteFunctions.formatAllNoteDateTime()},noteContainer_Click:function(a,b){if(a.target.tagName.toLowerCase()!="a"){NoteFunctions.editNote(b);a.stopPropagation()}},editNote:function(b){var a=$(".note-content",NoteFunctions.getNoteContainer(b));a.data("url",NoteFunctions.getCurrentEditUrl()+"?id="+b);InlineEditingRichTextAreaFunctions.display(a)},editNoteSuccess:function(a){var b=a.Content;var c=NoteFunctions.getNoteContainer(b.NoteId);c.find(".note-content").html(b.DecodedContent);NoteFunctions.notifyObservers()},createNoteSuccess:function(a){var b=$($("<div>").append(a.Content).find(".note-container")[0]).data("id");if(NoteFunctions.getNoteContainer(b).length){return}$(a.Content).insertBefore("#NoteListContainer .note-container.new-item");NoteFunctions.formatAllNoteDateTime();NoteFunctions.notifyObservers()},initializeSortSwitch:function(b,c){var a=$("input",b);a.prop("checked",c);a.bootstrapSwitch();a.on("switchChange.bootstrapSwitch",function(d,e){NoteFunctions.toggleOrderBy(a,d,e)});NoteFunctions.addObserver(NoteFunctions.updateSortSwitchVisibility);setTimeout(function(){NoteFunctions.updateSortSwitchVisibility()},50)},updateSortSwitchVisibility:function(){var a=$("#SortOrderCheckbox");if($(".note-container:not(.new-item)").length){a.removeClass("visibility-hidden")}else{a.addClass("visibility-hidden")}},toggleOrderBy:function(c,a,d){var b=!d;var e=NoteFunctions.getNoteUrl("SaveSortOrder");Nutcache.Ajax.TryAjaxCall({url:e,contentType:"application/json; charset=utf-8",type:"POST",data:JSON.stringify({isDescending:b}),dataType:"json",success:function(f){if(f.IsSaved){NoteFunctions.refreshNoteList(c)}else{LoadMessagesSection(f.Messages,"#floating-message-window")}},})},refreshNoteList:function(b){InlineEditingRichTextAreaFunctions.cancel("#NoteListContainer");var c=$(b).closest(".k-tabstrip").data("kendoTabStrip");var a=c.tabGroup.find("#tabNotes").index();var d=c.options.contentUrls[a];Nutcache.Ajax.TryAjaxCall({url:d,contentType:"application/json; charset=utf-8",type:"POST",dataType:"text",success:function(e){var f=$("<div>").append(e).find("#NoteListContainer");$("#NoteListContainer").replaceWith(f);NoteFunctions.formatAllNoteDateTime();NoteFunctions.moveNewElementToInitialPosition()},})}};