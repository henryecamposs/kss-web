var TaxFunctions={getTaxUrl:function(){return GetUrl("Tax")},showTaxPopupWindow:function(c,b,a){PopupWindow(c,"Tax",function(){TaxFunctions.saveTax(b)},a,null,"GetView",null)},saveTax:function(c){var b=$("#popup-window  #ID").val();var a=(typeof b=="undefined"||b=="0"?"Create":"Edit");var d=TaxFunctions.getTaxData();if(typeof d!=="undefined"){Nutcache.Ajax.TryAjaxCall({url:TaxFunctions.getTaxUrl()+a,contentType:"application/json;",type:"POST",data:JSON.stringify(d),dataType:"json",success:function(e){TaxFunctions.saveTaxSuccess(e,c)},error:ManageAjaxError})}},getTaxData:function(){var a=$("#gridTaxDetails").data("kendoGrid");var b={Id:$("#popup-window  #ID").val(),Description:$("#popup-window  #Description").val(),Status:$("#popup-window #Status").val(),Version:$("#popup-window  #Version").val(),TaxDetails:a.dataItems()};return b},saveTaxSuccess:function(a,b){if(a.IsRedirect){ShowErrors(a);return}if(a.IsSaved){ClosePopupWindow();if(b){b(a.Content)}}LoadMessagesSection(a.Messages,"#floating-message-window")},updateTotalRate:function(a){var b=0;a.dataItems().forEach(function(c){if(c.Compound){b=b*(1+c.Rate)+c.Rate}else{b+=c.Rate}});$("#TotalRate").html(kendo.toString(b,"p4"))},updateSequenceNumber:function(b){var a=b.dataSource.data();for(var c=0;c<a.length;c++){if(a[c].isNew()||a[c].dirty){a[c].SequenceNo=c+1}}},disableFirstCompoundCheckbox:function(d){var e=d.tbody[0].rows;if(e.length==0){return}var c=e[0];var a=$("td.tax-compound",c)[0];var b=$("input[type=checkbox]",a);$(b).prop("checked",false);$(b).prop("disabled",true)},deleteButtonTarget:null,deleteTaxDetail:function(c){var b=$("#HideDeleteConfirmationTitle").val();var a=$("#HideDeleteConfirmationMessage").val();TaxFunctions.deleteButtonTarget=c;OpenDeleteDialogWindow(b,a,"TaxFunctions.deleteTaxDetailConfirmed()",null)},deleteTaxDetailConfirmed:function(){var b=$(TaxFunctions.deleteButtonTarget).closest("tr");var a=$(TaxFunctions.deleteButtonTarget).closest(".k-grid").data("kendoGrid");a.removeRow(b)},getTaxInformations:function(b,a){if(b==null){b=0}Nutcache.Ajax.TryAjaxCall({url:TaxFunctions.getTaxUrl()+"GetTax",contentType:"application/x-www-form-urlencoded; charset=UTF-8",type:"POST",data:{taxId:b},dataType:"json",success:function(c){if(a){a(c.Content)}},error:ManageAjaxError})},IndexGrid_OnRecordSelected:function(b,a){TaxFunctions.showTaxPopupWindow(b.ID,function(){NutcacheGridFunctions.refreshGrids("#gridTaxes")},null)},GridTaxDetails_DataBound:function(a){TaxFunctions.disableFirstCompoundCheckbox(a.sender);TaxFunctions.updateSequenceNumber(a.sender);TaxFunctions.updateTotalRate(a.sender);NutcacheGridFunctions.nutcacheEditableGrid_OnDataBound(a)},GridTaxDetails_DataBinding:function(a){if(a.action=="add"&&a.index>=2){var b=a.sender;a.items[0].Compound=b.dataItems()[a.index-1].Compound}},GridTaxDetails_Edit:function(a){TaxFunctions.disableFirstCompoundCheckbox(a.sender);var b=$("#Rate",a.container);if(b.length>0){b.val((a.model.Rate*100).toFixed(4))}NutcacheGridFunctions.autoSelectInputText(a.container)},GridTaxDetails_Save:function(a){if(typeof a.values.Rate!="undefined"){a.model.Rate=Number((a.values.Rate/100).toFixed(6));a.preventDefault()}TaxFunctions.updateTotalRate(a.sender)},CompoundCheckBox_OnChanged:function(a){var f=$(a).parents("tr")[0].rowIndex-1;var b=$("#gridTaxDetails").data("kendoGrid");b.dataItems()[f].Compound=a.checked;for(var c=0;c<f;c++){b.dataItem(b.tbody[0].rows[c]).Compound=false;$("td.tax-compound input[type=checkbox]",b.tbody[0].rows[c]).prop("checked",false)}if(a.checked){for(var d=f+1;d<b.dataItems().length;d++){b.dataItem(b.tbody[0].rows[d]).Compound=true;$("td.tax-compound input[type=checkbox]",b.tbody[0].rows[d]).prop("checked",true)}}TaxFunctions.updateTotalRate(b)},actionEdit:function(a){TaxFunctions.showTaxPopupWindow(a.recordId,function(){NutcacheGridFunctions.refreshGrids("#"+a.config.gridName)})},actionDelete:function(b){var a=TaxFunctions.getTaxUrl()+"Delete/"+b.recordId;OpenDeleteDialogWindow(b.menuData.messages.deleteConfirmTitle,b.menuData.messages.deleteConfirmMessage,function(){window.location=a})}};