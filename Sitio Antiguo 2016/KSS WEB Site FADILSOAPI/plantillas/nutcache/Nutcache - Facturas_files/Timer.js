var TimerFunctions={getTimerUrl:function(a){if(a==null||a==""){return GetUrl("Timer")}return GetUrl("Timer")+a},clickTimers:function(){if($("#timers-container .timer-list-container").length){TimerFunctions.hideTimers()}else{TimerFunctions.showTimers()}},showTimers:function(){$("#timers-container").removeClass("item-hidden");Nutcache.Ajax.TryAjaxCall({url:TimerFunctions.getTimerUrl("RenderTimers"),contentType:"application/x-www-form-urlencoded; charset=UTF-8",type:"POST",dataType:"json",success:function(a){$("#timers-container").html(a.Content);$("#timers-container").removeClass("item-hidden");$(".nc-inline-dropdownlist, .nc-inline-timepicker").each(function(){$(this).text($(this).data("value")!=""?$(this).data("value"):$(this).data("emptyvalue"))});TimerFunctions.initializeTimeCircles();if(!$(".timer-box:not(.nc-template,.timer-pro)").length){$(".empty-timer-list").show()}else{$(".empty-timer-list").hide()}},error:ManageAjaxError})},hideTimers:function(){var a=$("#timers-container");InlineEditingDropDownListFunctions.cancel(a);InlineEditingTimePickerFunctions.cancel(a);InlineEditingInputTimeFunctions.cancel(a);$(".timer-box .timer-animation:not(.timer-box.nc-template .timer-animation)").each(function(){$(this).TimeCircles().destroy()});a.html("");a.addClass("item-hidden")},getTimerStartingData:function(){var b=$("#timers-container .timer-list-container"),a=b.data("serverUTCDelay")||0;return{DateTimeStartLocal:Nutcache.Dates.ToDateTimeString(new Date(),Nutcache.Dates.isoDateTimeFormatString),MaximumDateTimeEndUTC:Nutcache.Dates.ToDateTimeString(Nutcache.Dates.ConvertUTCDateToLocalDate(new Date(new Date().setHours(24,0,0,0)+a)),Nutcache.Dates.isoDateTimeFormatString)}},addTimer:function(b){var a=$.extend(TimerFunctions.getTimerStartingData(),b);Nutcache.Ajax.TryAjaxCall({url:TimerFunctions.getTimerUrl("Create"),contentType:"application/json; charset=utf-8",type:"POST",dataType:"json",data:JSON.stringify(a),success:function(c){if(c.IsSaved){var e=$("#timers-container .timer-list-container");if(e.length){var d=$(c.Content);d.insertBefore(e.find(".new-timer"));$(".nc-inline-dropdownlist, .nc-inline-timepicker").each(function(){$(this).text($(this).data("value")!=""?$(this).data("value"):$(this).data("emptyvalue"))});TimerFunctions.initializeTimeCircle(d.find(".timer-animation"));$(".empty-timer-list").hide();applyActiveBoxFade(d);d.show()}else{TimerFunctions.showTimers()}TimerFunctions.updateTimerCount()}LoadMessagesSection(c.Messages,"#floating-message-window")},error:ManageAjaxError})},updateTimerCount:function(){var a=$("#timers-container .timer-list-container");if(a.length){TimerFunctions.completeUpdateTimerCount(a.find(".timer-box:not(.nc-template,.timer-pro)").length)}else{Nutcache.Ajax.TryAjaxCall({url:TimerFunctions.getTimerUrl("GetTimerCount"),contentType:"application/json; charset=utf-8",type:"GET",success:function(b){TimerFunctions.completeUpdateTimerCount(b.Content.timerCount)},error:ManageAjaxError})}},completeUpdateTimerCount:function(a){var b=$(".timers-menu .bubble-count");if(a>0){b.text(a);b.removeClass("hidden")}else{b.addClass("hidden")}},deleteTimer:function(a){OpenDeleteDialogWindow($(".timer-list-container").data("delete-confirmation-title"),$(".timer-list-container").data("delete-confirmation-message"),function(){TimerFunctions.deleteTimerConfirmed(a)})},deleteTimerConfirmed:function(a){Nutcache.Ajax.TryAjaxCall({url:TimerFunctions.getTimerUrl("Delete"),contentType:"application/json; charset=utf-8",type:"POST",dataType:"json",data:JSON.stringify({id:a}),success:function(b){if(b.IsSaved){TimerFunctions.removeTimerBox(a)}LoadMessagesSection(b.Messages,"#floating-message-window")},error:ManageAjaxError})},removeTimerBox:function(b){var a=$(".timer-list-container div[data-id="+b+"]");if(a.length){a.remove()}if(!$(".timer-box:not(.nc-template,.timer-pro)").length){$(".empty-timer-list").show()}TimerFunctions.updateTimerCount()},setProjectOnTimerCard:function(a,d,c){var b=a.find(".timer-project-card");if(b.length){b.data("id",d);b.data("value",c);b.attr("title",c);b.text(b.data("value")!=""?b.data("value"):b.data("emptyvalue"))}},setItemOnTimerCard:function(a,d,c){var b=a.find(".timer-item-card");if(b.length){b.data("id",d);b.data("value",c);b.attr("title",c);b.text(b.data("value")!=""?b.data("value"):b.data("emptyvalue"))}},setProjectBoardCardOnTimerCard:function(a,d,c){var b=a.find(".timer-projectboardcard-card");if(b.length){b.text(c)}},setStartTimeOnTimerCard:function(a,b){var c=a.find(".timer-starttime-card");if(c.length){c.text(Nutcache.Dates.ConvertServerDateToLocalDateWithFormat(b,b,Nutcache.FormatInfo.TimeFormat))}},editProjectSuccess:function(a){var d=$(".timer-box[data-id="+a.Content.TimerId+"]");TimerFunctions.setProjectOnTimerCard(d,a.Content.ProjectId,a.Content.ProjectCode);var b=d.find(".timer-item-card");var c=b.data("lookupparams");c.projectId=a.Content.ProjectId;b.data("lookupparams",c)},editItemSuccess:function(a){TimerFunctions.setItemOnTimerCard($(".timer-box[data-id="+a.Content.TimerId+"]"),a.Content.ItemId,a.Content.ItemCode)},editStartTimeSuccess:function(a){var c=$(".timer-box[data-id="+a.Content.TimerId+"]"),b=c.find(".timer-animation");TimerFunctions.setStartTimeOnTimerCard(c,a.Content.StartTime);b.data("date-time-start-utc",a.Content.StartTimeUtc);TimerFunctions.displayTime(b,false)},editHoursSuccess:function(a){var c=$(".timer-box[data-id="+a.Content.TimerId+"]");if(c.length){var b=c.find(".timer-animation");b.data("minutes",a.Content.Minutes);TimerFunctions.manageTimerStatus(b,a.Content);TimerFunctions.displayTime(b,true)}},editHoursDisplay:function(a){var b=$(a).closest(".timer-animation");b.find(".timer-actions").hide();b.TimeCircles().stop()},editHoursCancel:function(a){var b=$(a).closest(".timer-animation");b.find(".timer-actions").show();if(parseInt(b.data("status"))==0){b.TimeCircles().start(b.data("tc-id"))}},startTimer:function(a){var c=$(a).closest(".timer-box").data("id");var b=$.extend(TimerFunctions.getTimerStartingData(),{ID:c});Nutcache.Ajax.TryAjaxCall({url:TimerFunctions.getTimerUrl("StartTimer"),contentType:"application/json; charset=utf-8",type:"POST",dataType:"json",data:JSON.stringify(b),success:function(d){if(d.IsSaved){var e=a.closest(".timer-animation");e.data("minutes",d.Content.Minutes);TimerFunctions.manageTimerStatus(e,d.Content)}LoadMessagesSection(d.Messages,"#floating-message-window")},error:ManageAjaxError})},stopTimer:function(a){var c=$(a).closest(".timer-box").data("id");var b=$.extend(TimerFunctions.getTimerStartingData(),{ID:c});Nutcache.Ajax.TryAjaxCall({url:TimerFunctions.getTimerUrl("StopTimer"),contentType:"application/json; charset=utf-8",type:"POST",dataType:"json",data:JSON.stringify(b),success:function(d){if(d.IsSaved){var e=a.closest(".timer-animation");e.data("minutes",d.Content.Minutes);TimerFunctions.manageTimerStatus(e,d.Content);TimerFunctions.displayTime(e,false)}LoadMessagesSection(d.Messages,"#floating-message-window")},error:ManageAjaxError})},manageTimerStatus:function(c,a){var b=$(c);if(b.length){if(a!=null){b.data("status",a.Status)}if(parseInt($("#TimeTrackingType").val())==0){if(b.data("status")==0){if(a!=null){b.data("date-time-start-utc",a.DateTimeStartUTC)}b.find(".action").addClass("fa-pause").removeClass("fa-play")}else{b.find(".action").addClass("fa-play").removeClass("fa-pause")}}b.data("status")==0?b.TimeCircles().start(b.data("tc-id")):b.TimeCircles().stop(b.data("tc-id"))}},editTimerStatus:function(a){parseInt($(a).closest(".timer-animation").data("status"))==0?TimerFunctions.stopTimer(a):TimerFunctions.startTimer(a)},adjustTime:function(b,c,a){if(c==0&&a!=0){TimerFunctions.displayTime(this,false)}},displayTime:function(b,c){var g=$(".timer-list-container").data("serverUTCDelay");var a=new Date(parseInt($(b).data("date-time-start-utc"))-g);var d=parseInt($(b).data("minutes"));var f=d+($(b).data("status")==0?((new Date()-a)/1000/60):0);if(f>=999*60+59){TimerFunctions.stopTimer(b)}var h=Nutcache.Time.GetHours(f/60)+":"+Nutcache.Strings.Add0ToDigit(~~(f%60));$(b).find(".timer-hours").text(h);$(b).find(".timer-hours").data("value",h);if(c){if($(b).data("status")==0){$(b).TimeCircles({ref_date:a})}else{$(b).TimeCircles({ref_date:a.setSeconds(new Date().getSeconds())})}}},initializeTimeCircle:function(a){$(a).TimeCircles({start:false,bg_width:0.2,fg_width:0.03,circle_bg_color:"#BDBDBD",time:{Days:{show:false},Hours:{show:false},Minutes:{show:false},Seconds:{text:"",color:window.accentColor,show:true}}});$(a).find(".time_circles .textDiv_Seconds > span").hide();var b=$(a).find(".time_circles .textDiv_Seconds > h4");$(a).find(".timer-hours-container").insertBefore(b);b.hide();$(a).find(".timer-actions").insertAfter($(a).find(".time_circles .textDiv_Seconds > h4"));TimerFunctions.displayTime(a,true);$(a).TimeCircles().addListener(TimerFunctions.adjustTime);TimerFunctions.manageTimerStatus($(a),null);$(a).find(".action").on("click",function(){TimerFunctions.editTimerStatus($(this))});$(a).find(".save").on("click",function(){WorkingHourFunctions.createWorkingHourFromTimer($(this).closest(".timer-box").data("id"))})},initializeTimeCircles:function(){$(".timer-box .timer-animation:not(.timer-box.nc-template .timer-animation)").each(function(){TimerFunctions.initializeTimeCircle($(this))})}};$(document).click(function(a){if($(a.target).closest("#timers-container .timer-list-container").length==0&&$(a.target).closest("#nc-dropdownlist-list").length==0&&$(a.target).closest("#nc-timepicker_timeview").length==0&&$(a.target).closest(".k-window").length==0&&$(a.target).closest(".nc-popup-window").length==0&&$(a.target).closest(".inmplayer-popover-content").length==0&&$(a.target).closest(".k-list-container").length==0){TimerFunctions.hideTimers()}});