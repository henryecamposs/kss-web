var UserPageFunctions={saveAndNew:function(a){UserPageFunctions.validateUserCompany(function(){UserPageFunctions.save(a,true)})},discardAndNew:function(){GoogleAnalyticsFunctions.TrackEvent("link","create","UserFromPlusButton","0");window.location=UserFunctions.getUserUrl("Create")},save:function(c,b){var d=$("#uploadsInProgress");if(d.length&&d.val()!="0"){ShowErrorMessages($("#uploadsInProgressText").val());return}var e=UserPageFunctions.getUserCompanyData();if(e==null){return}var a=(typeof e.UserCompanyId=="undefined"||e.UserCompanyId=="0")?"Create":"Edit";Nutcache.Waitingwindow.Show();Nutcache.Ajax.TryAjaxCall({url:UserFunctions.getUserUrl(a),contentType:"application/json; charset=utf-8",type:"POST",data:JSON.stringify(e),dataType:"json",success:function(f){UserPageFunctions.saveSuccess(f,c,b)},error:ManageAjaxError})},saveSuccess:function(a,c,b){Nutcache.Waitingwindow.Hide();if(!a.IsSaved&&a.IsRedirect){Nutcache.Messages.handleAjaxErrors(a)}else{if(a.IsSaved){if(a.IsRedirect||b){Nutcache.AutoCallback.addSingleCall(Nutcache.Messages.displayMessageHtml,a.Messages);if(b){GoogleAnalyticsFunctions.TrackEvent("link","create","UserFromPlusButton","0");window.location=UserFunctions.getUserUrl("Create")}else{window.location=a.Content}}else{Nutcache.Messages.displayMessageHtml(a.Messages);Nutcache.AutoCallback.executeCallback(c)}}}},newUser:function(){if(UserPageFunctions.isUserDirty()){var c=$("#HideDirtyConfirmationTitle").val();var b=$("#HideDirtyConfirmationMessage").val();var a=[{buttonClass:"nc-button nutcache-button ripplelink",onClickFunction:function(){UserPageFunctions.saveAndNew()},text:window.saveString},{buttonClass:"nc-button nutcache-button ripplelink",onClickFunction:function(){UserPageFunctions.discardAndNew()},text:window.discardString},{buttonClass:"nc-button nutcache-cancel-button ripplelink",onClickFunction:null,text:window.cancelString}];OpenDialogWindowWithButtons(c,b,a)}else{GoogleAnalyticsFunctions.TrackEvent("link","create","UserFromPlusButton","0");window.location=UserFunctions.getUserUrl("Create")}},getUserCompanyData:function(a){var b={UserCompanyId:$("#UserCompanyId",a).val(),Version:$("#Version",a).val(),Name:$("#Name",a).val(),Email:$("#Email",a).val(),CommunicationCultureCode:$("#CommunicationCultureCode",a).val(),IsGuest:$("#IsGuest",a).is(":checked"),JobTitle:$("#JobTitle",a).val(),Phone:$("#Phone",a).val(),PhoneMobile:$("#PhoneMobile",a).val(),EmploymentStartDate:Nutcache.Dates.ToISODateString($("#EmploymentStartDate",a).data("kendoDatePicker").value()),EmploymentEndDate:Nutcache.Dates.ToISODateString($("#EmploymentEndDate",a).data("kendoDatePicker").value()),SecurityProfileId:$("#SecurityProfileId",a).val(),Reactivate:$("#Reactivate",a).val(),UserCompanyIdToRevoke:$("#UserCompanyIdToRevoke",a).val(),DisplayName:$("#DisplayName",a).val()};return b},userActionResendInvitation:function(a){UserPageFunctions.performDirtyCheckThenDo(a.menuData.messages.autoSaveConfirmTitle,a.menuData.messages.autoSaveConfirmMessage,function(){var d=a.menuData.messages.resendInvitationConfirmTitle;var c=a.menuData.messages.resendInvitationConfirmMessage;var b=a.menuData.messages.resendInvitationConfirmActionButton;OpenActionDialogWindow(d,c,b,function(){UserFunctions.performActionOnUserCompany(a.recordId,a.recordVersion,"ResendInvitation",function(){UserPageFunctions.refreshUser()})})})},userActionActivate:function(a){UserPageFunctions.performDirtyCheckThenDo(a.menuData.messages.autoSaveConfirmTitle,a.menuData.messages.autoSaveConfirmMessage,function(){var d=a.menuData.messages.activateConfirmTitle;var c=a.menuData.messages.activateConfirmMessage;var b=a.menuData.messages.activateConfirmActionButton;OpenActionDialogWindow(d,c,b,function(){UserFunctions.performActionOnUserCompany(a.recordId,a.recordVersion,"Activate",function(){UserPageFunctions.refreshUser()})})})},userActionDeactivate:function(a){UserPageFunctions.performDirtyCheckThenDo(a.menuData.messages.autoSaveConfirmTitle,a.menuData.messages.autoSaveConfirmMessage,function(){var d=a.menuData.messages.deactivateConfirmTitle;var c=a.menuData.messages.deactivateConfirmMessage;var b=a.menuData.messages.deactivateConfirmActionButton;OpenActionDialogWindow(d,c,b,function(){UserFunctions.performActionOnUserCompany(a.recordId,a.recordVersion,"Deactivate",function(){UserPageFunctions.refreshUser()})})})},userActionRevoke:function(a){UserPageFunctions.performDirtyCheckThenDo(a.menuData.messages.autoSaveConfirmTitle,a.menuData.messages.autoSaveConfirmMessage,function(){var d=a.menuData.messages.revokeAccessConfirmTitle;var c=a.menuData.messages.revokeAccessConfirmMessage;var b=a.menuData.messages.revokeAccessConfirmActionButton;OpenActionDialogWindow(d,c,b,function(){UserFunctions.performActionOnUserCompany(a.recordId,a.recordVersion,"Revoke",function(){window.location=UserFunctions.getUserUrl("Index")})})})},userActionTransferOwnership:function(c){var b=c.menuData.messages.transferOwnershipConfirmTitle;var a=c.menuData.messages.transferOwnershipConfirmActionButton;UserFunctions.checkOwnershipTransfer(c.config.userProfileId,b,a,function(){UserFunctions.performActionOnUserCompany(c.recordId,c.recordVersion,"TransferOwnership",function(){UserPageFunctions.refreshUser()})})},performDirtyCheckThenDo:function(c,b,a){if(UserPageFunctions.isUserDirty()){OpenDialogWindow(c,b,a)}else{a()}},isUserDirty:function(){var a=$(".member-tab-info-container");if(a.length==0){return false}return Nutcache.ChangeDetection.FindChanges(a[0]).length>0},getUserSummary:function(b,a){Nutcache.Ajax.TryAjaxCall({url:UserFunctions.getUserUrl("GetSummary"),contentType:"application/json; charset=utf-8",type:"POST",data:JSON.stringify({userCompanyId:b}),dataType:"json",success:function(c){if(c.IsSaved&&a){a(c.Content)}},error:ManageAjaxError})},manageTabsVisibility:function(b){var a=$("#IsEmployeeConversion").val().toLowerCase()=="true";if(b=="Guest"&&!a){$("#tabProjects").hide()}else{$("#tabProjects").show()}},refreshBubbleCounts:function(){userCompanyId=UserFunctions.getUserId();if((typeof userCompanyId!="undefined")&&(userCompanyId>0)){UserPageFunctions.getUserSummary(userCompanyId,function(a){UserPageFunctions.refreshBubbleCount($("#tabProjects .bubble-count"),a.ProjectsCount);UserPageFunctions.refreshBubbleCount($("#tabAttachments .bubble-count"),a.AttachmentsCount);UserPageFunctions.refreshBubbleCount($("#tabNotes .bubble-count"),a.NotesCount)})}},refreshBubbleCount:function(b,a){if(a>0){b.show();b.text(a>99?"99+":a)}else{b.hide()}},refreshUser:function(a){UserPageFunctions.refreshBubbleCounts();var b=UserFunctions.getUserId();if(b==undefined||b==0){b=$("#UserCompanyId").val();window.location=UserFunctions.getUserUrl("Edit")+"?id="+b;return}Nutcache.Ajax.TryAjaxCall({url:UserFunctions.getUserUrl("RenderEditView"),contentType:"application/json; charset=utf-8",type:"POST",data:JSON.stringify({userCompanyId:b}),dataType:"json",success:function(c){if(c.MainHeaderPartial.length){$(".main-header-section").replaceWith(c.MainHeaderPartial)}if(c.TabInformationPartial.length){$(".member-tab-info-container").replaceWith(c.TabInformationPartial)}Nutcache.AutoCallback.executeCallback(a)},error:ManageAjaxError})},gridProjects_OnDataBound:function(a){var b=a.sender.dataSource.view();for(var c=0;c<b.length;c++){if(b[c].Status==0){a.sender.table.find("tr[data-uid='"+b[c].uid+"']").addClass("deleted-row")}}NutcacheGridFunctions.setNoDataMinHeight(a.sender,true)},refreshProjectMemberDDL:function(){var a=$("#ProjectToAssign").data("kendoDropDownList");a.dataSource.read().done(function(){a.select(0)});$("#ProjectToAssign").data("kendoDropDownList").select(0)},addSelectedProjectToProjectMember:function(){var a=$("#ProjectToAssign").val();var b=UserFunctions.getUserId();if(a!=""){UserPageFunctions.createProjectMember(b,a)}},addAllProjectMember:function(){var b=$("#AddProjectConfirmationTitle").val();var a=$("#AddAllProjectsConfirmationMessage").val();OpenDialogWindow(b,a,function(){var c=UserFunctions.getUserId();UserPageFunctions.createAllProjectMember(c)})},removeAllProjectMember:function(){var b=$("#RemoveProjectConfirmationTitle").val();var a=$("#RemoveAllProjectsConfirmationMessage").val();OpenDialogWindow(b,a,function(){var c=UserFunctions.getUserId();UserPageFunctions.deleteAllProjectMember(c)})},createProjectMember:function(b,a){Nutcache.Waitingwindow.Show();Nutcache.Ajax.TryAjaxCall({url:UserFunctions.getProjectMemberUrl("Create"),contentType:"application/json; charset=utf-8",type:"POST",data:JSON.stringify({userCompanyId:b,projectId:a}),dataType:"json",success:function(c){Nutcache.Waitingwindow.Hide();if(c.IsSaved){NutcacheGridFunctions.refreshGrids("#gridMemberAssignedProjects");UserPageFunctions.refreshProjectMemberDDL();UserPageFunctions.refreshBubbleCounts()}LoadMessagesSection(c.Messages,"#floating-message-window")},error:ManageAjaxError})},createAllProjectMember:function(a){Nutcache.Waitingwindow.Show();Nutcache.Ajax.TryAjaxCall({url:UserFunctions.getProjectMemberUrl("CreateAllForMember"),contentType:"application/json; charset=utf-8",type:"POST",data:JSON.stringify({userCompanyId:a}),dataType:"json",success:function(b){Nutcache.Waitingwindow.Hide();if(b.IsSaved){NutcacheGridFunctions.refreshGrids("#gridMemberAssignedProjects");UserPageFunctions.refreshProjectMemberDDL();UserPageFunctions.refreshBubbleCounts()}LoadMessagesSection(b.Messages,"#floating-message-window")},error:ManageAjaxError})},activateProjectMember:function(a){Nutcache.Waitingwindow.Show();Nutcache.Ajax.TryAjaxCall({url:UserFunctions.getProjectMemberUrl("Activate"),contentType:"application/json; charset=utf-8",type:"POST",data:JSON.stringify({id:a}),dataType:"json",success:function(b){Nutcache.Waitingwindow.Hide();if(b.IsSaved){NutcacheGridFunctions.refreshGrids("#gridMemberAssignedProjects");UserPageFunctions.refreshBubbleCounts()}LoadMessagesSection(b.Messages,"#floating-message-window")},error:ManageAjaxError})},deleteProjectMember:function(b){var c=$("#RemoveProjectConfirmationTitle").val();var a=$("#RemoveSingleProjectsConfirmationMessage").val();OpenDialogWindow(c,a,function(){Nutcache.Waitingwindow.Show();Nutcache.Ajax.TryAjaxCall({url:UserFunctions.getProjectMemberUrl("Delete"),contentType:"application/json; charset=utf-8",type:"POST",data:JSON.stringify({projectMemberId:b}),dataType:"json",success:function(d){Nutcache.Waitingwindow.Hide();if(d.IsSaved){NutcacheGridFunctions.refreshGrids("#gridMemberAssignedProjects");UserPageFunctions.refreshProjectMemberDDL();UserPageFunctions.refreshBubbleCounts()}LoadMessagesSection(d.Messages,"#floating-message-window")},error:ManageAjaxError})})},deleteAllProjectMember:function(a){Nutcache.Waitingwindow.Show();Nutcache.Ajax.TryAjaxCall({url:UserFunctions.getProjectMemberUrl("DeleteAllForMember"),contentType:"application/json; charset=utf-8",type:"POST",data:JSON.stringify({userCompanyId:a}),dataType:"json",success:function(b){Nutcache.Waitingwindow.Hide();if(b.IsSaved){NutcacheGridFunctions.refreshGrids("#gridMemberAssignedProjects");UserPageFunctions.refreshProjectMemberDDL();UserPageFunctions.refreshBubbleCounts()}LoadMessagesSection(b.Messages,"#floating-message-window")},error:ManageAjaxError})},onAttachmentDeleteConfirmed:function(a){Nutcache.Ajax.TryAjaxCall({url:UserFunctions.getUserUrl("DeleteAttachment"),contentType:"application/json; charset=utf-8",type:"POST",dataType:"json",data:JSON.stringify({ID:a.data("id")}),success:function(b){if(b.IsSaved){$(".attachment-container[data-id="+a.data("id")+"]").remove();AttachmentFunctions.removeAttachmentConfirmed(a)}LoadMessagesSection(b.Messages,"#floating-message-window")},error:ManageAjaxError},true)},validateUserCompany:function(a){Nutcache.Waitingwindow.Show();var b=UserPageFunctions.getUserCompanyData();Nutcache.Ajax.TryAjaxCall({url:UserFunctions.getUserUrl("ValidateRevokedUser"),contentType:"application/json;",type:"POST",data:JSON.stringify({email:b.Email,userCompanyID:b.UserCompanyId}),dataType:"json",success:function(c){Nutcache.Waitingwindow.Hide();if(c.IsValid){Nutcache.AutoCallback.executeCallback(a)}else{if(c.DialogMessage==undefined){LoadMessagesSection(c.Messages,"#floating-message-window");return}OpenDialogWindow(c.DialogTitle,c.DialogMessage,function(){$("#UserCompanyIdToRevoke").val($("#UserCompanyId").val());$("#UserCompanyId").val(c.UserCompanyId);$("#Version").val(c.UserCompanyVersion);$("#Reactivate").val(true);Nutcache.AutoCallback.executeCallback(a)})}LoadMessagesSection(c.Messages,"#floating-message-window")},error:ManageAjaxError})}};var UserPopupFunctions={ShowUserCompanyPopup:function(c,b,a){PopupWindowFunctions.openPopupWindow(UserFunctions.getUserUrl("GetView"),function(d){UserPopupFunctions.validateUserCompany(d,b)},a,null)},save:function(a,b){var c=UserFunctions.getUserUrl("CreateFromPopup");var d=UserPopupFunctions.getUserCompanyData(a.wrapper);if(d==null){return}Nutcache.Ajax.TryAjaxCall({url:c,contentType:"application/json; charset=utf-8",type:"POST",data:JSON.stringify({viewModel:d}),dataType:"json",success:function(e){UserPopupFunctions.saveSuccess(a,e,b)},error:ManageAjaxError})},saveSuccess:function(b,a,c){if(!a.IsSaved&&a.IsRedirect){Nutcache.Messages.handleAjaxErrors(a,b.element)}else{if(a.IsSaved){b.close();if(c){c(a.Content)}Nutcache.Messages.displayMessageHtml(a.Messages)}}},getUserCompanyData:function(a){return{UserCompanyId:$("#UserCompanyId",a).val(),DisplayName:$("#DisplayName",a).val(),Email:$("#Email",a).val(),CommunicationCultureCode:$("#CommunicationCultureCode",a).val(),Reactivate:$("#Reactivate",a).val(),SecurityProfileId:$("#SecurityProfileId",a).val()}},validateUserCompany:function(a,b){Nutcache.Waitingwindow.Show();var c=UserPopupFunctions.getUserCompanyData(a.wrapper);Nutcache.Ajax.TryAjaxCall({url:UserFunctions.getUserUrl("ValidateRevokedUser"),contentType:"application/json;",type:"POST",data:JSON.stringify({email:c.Email,userCompanyID:c.UserCompanyId}),dataType:"json",success:function(d){Nutcache.Waitingwindow.Hide();if(d.IsValid){UserPopupFunctions.save(a,b)}else{OpenDialogWindow(d.DialogTitle,d.DialogMessage,function(){$("#UserCompanyEditPopup #UserCompanyIdToRevoke").val($("#UserCompanyEditPopup #UserCompanyId").val());$("#UserCompanyEditPopup #UserCompanyId").val(d.UserCompanyId);$("#UserCompanyEditPopup #Version").val(d.UserCompanyVersion);$("#UserCompanyEditPopup #Reactivate").val(true);UserPopupFunctions.save(a,b)})}LoadMessagesSection(d.Messages,"#floating-message-window")},error:ManageAjaxError})}};var UserFunctions={getUserUrl:function(a){if(a==null||a==""){return GetUrl("User")}return GetUrl("User")+a},getProjectMemberUrl:function(a){if(a==null||a==""){return GetUrl("ProjectMember")}return GetUrl("ProjectMember")+a},getUserId:function(){return $(".main-header-section").data("id")},UserIndexGrid_OnRecordSelected:function(b,a){window.location=UserFunctions.getUserUrl("Edit")+"/"+b.ID},setSuccessJsCallbackFunction:function(a,b){$("#SuccessJsCallbackFunction",a).val(String(b).replace(/"/g,"'"))},performActionOnUserCompany:function(c,d,a,b){Nutcache.Waitingwindow.Show();Nutcache.Ajax.TryAjaxCall({url:UserFunctions.getUserUrl(a),contentType:"application/json; charset=utf-8",type:"POST",data:JSON.stringify({id:c,version:d}),dataType:"json",success:function(e){Nutcache.Waitingwindow.Hide();if(e.IsSaved){b(e)}LoadMessagesSection(e.Messages,"#floating-message-window")},error:ManageAjaxError})},checkOwnershipTransfer:function(d,c,a,b){Nutcache.Ajax.TryAjaxCall({url:UserFunctions.getUserUrl("PrevalidateOwnershipTransfer"),contentType:"application/json; charset=UTF-8",type:"POST",data:JSON.stringify({UserProfileId:d}),dataType:"json",success:function(e){if(e.IsRedirect){ShowErrors(e)}else{if(!e.Content||e.Content.length==0){b()}else{OpenActionDialogWindow(c,e.Content,a,b)}}},error:ManageAjaxError})},userActionEdit:function(a){window.location=UserFunctions.getUserUrl("Edit")+"/"+a.recordId},userActionResendInvitationFromIndex:function(d){var c=d.menuData.messages.resendInvitationConfirmTitle;var b=d.menuData.messages.resendInvitationConfirmMessage;var a=d.menuData.messages.resendInvitationConfirmActionButton;OpenActionDialogWindow(c,b,a,function(){UserFunctions.performActionOnUserCompany(d.recordId,d.recordVersion,"ResendInvitation",function(){NutcacheGridFunctions.refreshGrids("#gridUsers")})})},userActionActivateFromIndex:function(d){var c=d.menuData.messages.activateConfirmTitle;var b=d.menuData.messages.activateConfirmMessage;var a=d.menuData.messages.activateConfirmActionButton;OpenActionDialogWindow(c,b,a,function(){UserFunctions.performActionOnUserCompany(d.recordId,d.recordVersion,"Activate",function(){NutcacheGridFunctions.refreshGrids("#gridUsers")})})},userActionDeactivateFromIndex:function(d){var c=d.menuData.messages.deactivateConfirmTitle;var b=d.menuData.messages.deactivateConfirmMessage;var a=d.menuData.messages.deactivateConfirmActionButton;OpenActionDialogWindow(c,b,a,function(){UserFunctions.performActionOnUserCompany(d.recordId,d.recordVersion,"Deactivate",function(){NutcacheGridFunctions.refreshGrids("#gridUsers")})})},userActionRevokeFromIndex:function(d){var c=d.menuData.messages.revokeAccessConfirmTitle;var b=d.menuData.messages.revokeAccessConfirmMessage;var a=d.menuData.messages.revokeAccessConfirmActionButton;OpenActionDialogWindow(c,b,a,function(){UserFunctions.performActionOnUserCompany(d.recordId,d.recordVersion,"Revoke",function(){NutcacheGridFunctions.refreshGrids("#gridUsers")})})},userActionTransferOwnershipFromIndex:function(c){var b=c.menuData.messages.transferOwnershipConfirmTitle;var a=c.menuData.messages.transferOwnershipConfirmActionButton;UserFunctions.checkOwnershipTransfer(c.config.userProfileId,b,a,function(){UserFunctions.performActionOnUserCompany(c.recordId,c.recordVersion,"TransferOwnership",function(){NutcacheGridFunctions.refreshGrids("#gridUsers")})})},refreshPermissions:function(){var b=$("#SecurityProfileId").data("kendoDropDownList");var a=b.dataItem(b.selectedIndex);if(a.ID>0){$("input:radio[name=user-Administration][data-value="+a.Administration+"]").prop("checked",true);$("input:radio[name=user-Maintenance][data-value="+a.Maintenance+"]").prop("checked",true);$("input:radio[name=user-TimesheetApprovalByTeam][data-value="+a.TimesheetApprovalByTeam+"]").prop("checked",true);$("input:radio[name=user-Project][data-value="+a.Project+"]").prop("checked",true);$("input:radio[name=user-TimesheetApprovalByProject][data-value="+a.TimesheetApprovalByProject+"]").prop("checked",true);$("input:radio[name=user-TeamManagement][data-value="+a.TeamManagement+"]").prop("checked",true);$("input:radio[name=user-TimesheetApprovalByTeam][data-value="+a.TimesheetApprovalByTeam+"]").prop("checked",true);$("input:radio[name=user-TimeTracking][data-value="+a.TimeTracking+"]").prop("checked",true);$("input:radio[name=user-Expense][data-value="+a.Expense+"]").prop("checked",true);$("input:radio[name=user-Sale][data-value="+a.Sale+"]").prop("checked",true)}else{$("input:radio[name^=user-][data-value=0]").prop("checked",true)}$("#SecurityProfileDescriptionContainer div").html(a.LongDescription);UserPageFunctions.manageTabsVisibility(a.Code)},securityProfile_onchange:function(b){var f=function(){UserFunctions.refreshPermissions()};var d=function(e){Nutcache.KendoUI.dropDownListWithAddNewSuccess(e,b.sender,f)};var c=function(){Nutcache.KendoUI.dropDownListWithAddNewCancel(b.sender)};var a=function(){SecurityProfileFunctions.showPopupWindow(0,d,c)};var g=f;Nutcache.KendoUI.dropDownListWithAddNew_onChange(b.sender,a,g)},displayPermission:function(b,d,a,e,c){b?$(c).addClass("active"):$(c).removeClass("active")},popupThemeListWindow:function(){var a=UserFunctions.getUserUrl("RenderThemeList");Nutcache.Waitingwindow.Show();GoogleAnalyticsFunctions.TrackEvent("menu","open","ThemeChooser","0");Nutcache.Ajax.TryAjaxCall({url:a,contentType:"application/json; charset=utf-8",type:"POST",dataType:"json",success:function(b){Nutcache.Waitingwindow.Hide();if(b.IsRedirect){ShowErrors(b)}else{var d=$("#popup-window");var c=d.data("kendoWindow");c.content(b.Content);c.title(b.Title);$(document).on("click",".k-overlay",function(){c.close()});c.center().open()}},error:ManageAjaxError})},setTheme:function(a){var b=UserFunctions.getUserUrl("SetTheme");Nutcache.Ajax.TryAjaxCall({url:b,contentType:"application/json; charset=utf-8",type:"POST",data:JSON.stringify({theme:a}),dataType:"json",success:function(c){if(c.IsSaved){location.reload()}else{ShowErrors(c)}},error:ManageAjaxError})}};$(document).ready(function(){$(".permission-scope").bootstrapSwitch()});