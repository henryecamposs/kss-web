JustGage=function(c){if(!c.id){alert("Missing id parameter for gauge!");return false}if(!document.getElementById(c.id)){alert('No element with id: "'+c.id+'" found!');return false}this.config={id:c.id,title:(c.title)?c.title:"Title",titleFontColor:(c.titleFontColor)?c.titleFontColor:"#999999",value:(c.value)?c.value:0,valueFontColor:(c.valueFontColor)?c.valueFontColor:"#010101",min:(c.min)?c.min:0,max:(c.max)?c.max:100,showMinMax:(c.showMinMax!=null)?c.showMinMax:true,gaugeWidthScale:(c.gaugeWidthScale)?c.gaugeWidthScale:1,gaugeColor:(c.gaugeColor)?c.gaugeColor:"#edebeb",label:(c.label)?c.label:"",showInnerShadow:(c.showInnerShadow!=null)?c.showInnerShadow:true,shadowOpacity:(c.shadowOpacity)?c.shadowOpacity:0.2,shadowSize:(c.shadowSize)?c.shadowSize:5,shadowVerticalOffset:(c.shadowVerticalOffset)?c.shadowVerticalOffset:3,levelColors:(c.levelColors)?c.levelColors:percentColors,levelColorsGradient:(c.levelColorsGradient!=null)?c.levelColorsGradient:true,labelFontColor:(c.labelFontColor)?c.labelFontColor:"#b3b3b3",startAnimationTime:(c.startAnimationTime)?c.startAnimationTime:700,startAnimationType:(c.startAnimationType)?c.startAnimationType:">",refreshAnimationTime:(c.refreshAnimationTime)?c.refreshAnimationTime:700,refreshAnimationType:(c.refreshAnimationType)?c.refreshAnimationType:">"};if(c.value>this.config.max){this.config.value=this.config.max}if(c.value<this.config.min){this.config.value=this.config.min}this.originalValue=c.value;this.canvas=Raphael(this.config.id,"100%","100%");var b=getStyle(document.getElementById(this.config.id),"width").slice(0,-2)*1;var a=getStyle(document.getElementById(this.config.id),"height").slice(0,-2)*1;var x,w;if((b/a)>1.25){x=1.25*a;w=a}else{x=b;w=b/1.25}var e=(b-x)/2;var f=(a-w)/2;var q=((w/8)>10)?(w/10):10;var r=e+x/2;var s=f+w/6.5;var t=((w/6.4)>16)?(w/6.4):16;var u=e+x/2;var v=f+w/1.4;var g=((w/16)>10)?(w/16):10;var h=e+x/2;var i=v+t/2+6;var m=((w/16)>10)?(w/16):10;var n=e+(x/10)+(x/6.666666666666667*this.config.gaugeWidthScale)/2;var o=f+w/1.126760563380282;var j=((w/16)>10)?(w/16):10;var k=e+x-(x/10)-(x/6.666666666666667*this.config.gaugeWidthScale)/2;var l=f+w/1.126760563380282;this.params={canvasW:b,canvasH:a,widgetW:x,widgetH:w,dx:e,dy:f,titleFontSize:q,titleX:r,titleY:s,valueFontSize:t,valueX:u,valueY:v,labelFontSize:g,labelX:h,labelY:i,minFontSize:m,minX:n,minY:o,maxFontSize:j,maxX:k,maxY:l};this.canvas.customAttributes.pki=function(K,G,F,L,E,B,C,D){var y=(1-(K-G)/(F-G))*Math.PI,J=L/2-L/10,I=J-L/6.666666666666667*D,z=L/2+B,A=E/1.25+C,N=L/2+B+J*Math.cos(y),P=E-(E-A)+C-J*Math.sin(y),M=L/2+B+I*Math.cos(y),O=E-(E-A)+C-I*Math.sin(y),H;H+="M"+(z-I)+","+A+" ";H+="L"+(z-J)+","+A+" ";H+="A"+J+","+J+" 0 0,1 "+N+","+P+" ";H+="L"+M+","+O+" ";H+="A"+I+","+I+" 0 0,0 "+(z-I)+","+A+" ";H+="z ";return{path:H}};this.gauge=this.canvas.path().attr({stroke:"none",fill:this.config.gaugeColor,pki:[this.config.max,this.config.min,this.config.max,this.params.widgetW,this.params.widgetH,this.params.dx,this.params.dy,this.config.gaugeWidthScale]});this.gauge.id=this.config.id+"-gauge";this.level=this.canvas.path().attr({stroke:"none",fill:getColorForPercentage((this.config.value-this.config.min)/(this.config.max-this.config.min),this.config.levelColors,this.config.levelColorsGradient),pki:[this.config.min,this.config.min,this.config.max,this.params.widgetW,this.params.widgetH,this.params.dx,this.params.dy,this.config.gaugeWidthScale]});this.level.id=this.config.id+"-level";this.txtTitle=this.canvas.text(this.params.titleX,this.params.titleY,this.config.title);this.txtTitle.attr({"font-size":this.params.titleFontSize,"font-weight":"bold","font-family":"Arial",fill:this.config.titleFontColor,"fill-opacity":"1"});this.txtTitle.id=this.config.id+"-txttitle";this.txtValue=this.canvas.text(this.params.valueX,this.params.valueY,this.originalValue);this.txtValue.attr({"font-size":this.params.valueFontSize,"font-weight":"bold","font-family":"Arial",fill:this.config.valueFontColor,"fill-opacity":"0"});this.txtValue.id=this.config.id+"-txtvalue";this.txtLabel=this.canvas.text(this.params.labelX,this.params.labelY,this.config.label);this.txtLabel.attr({"font-size":this.params.labelFontSize,"font-weight":"normal","font-family":"Arial",fill:this.config.labelFontColor,"fill-opacity":"0"});this.txtLabel.id=this.config.id+"-txtlabel";this.txtMin=this.canvas.text(this.params.minX,this.params.minY,this.config.min);this.txtMin.attr({"font-size":this.params.minFontSize,"font-weight":"normal","font-family":"Arial",fill:this.config.labelFontColor,"fill-opacity":(this.config.showMinMax==true)?"1":"0"});this.txtMin.id=this.config.id+"-txtmin";this.txtMax=this.canvas.text(this.params.maxX,this.params.maxY,this.config.max);this.txtMax.attr({"font-size":this.params.maxFontSize,"font-weight":"normal","font-family":"Arial",fill:this.config.labelFontColor,"fill-opacity":(this.config.showMinMax==true)?"1":"0"});this.txtMax.id=this.config.id+"-txtmax";var d=this.canvas.canvas.childNodes[1];var p="http://www.w3.org/2000/svg";if(ie<9){onCreateElementNsReady(function(){this.generateShadow()})}else{this.generateShadow(p,d)}this.level.animate({pki:[this.config.value,this.config.min,this.config.max,this.params.widgetW,this.params.widgetH,this.params.dx,this.params.dy,this.config.gaugeWidthScale]},this.config.startAnimationTime,this.config.startAnimationType);this.txtValue.animate({"fill-opacity":"1"},this.config.startAnimationTime,this.config.startAnimationType);this.txtLabel.animate({"fill-opacity":"1"},this.config.startAnimationTime,this.config.startAnimationType)};JustGage.prototype.refresh=function(b){originalVal=b;if(b>this.config.max){b=this.config.max}if(b<this.config.min){b=this.config.min}var a=getColorForPercentage((b-this.config.min)/(this.config.max-this.config.min),this.config.levelColors,this.config.levelColorsGradient);this.canvas.getById(this.config.id+"-txtvalue").attr({text:originalVal});this.canvas.getById(this.config.id+"-level").animate({pki:[b,this.config.min,this.config.max,this.params.widgetW,this.params.widgetH,this.params.dx,this.params.dy,this.config.gaugeWidthScale],fill:a},this.config.refreshAnimationTime,this.config.refreshAnimationType)};var percentColors=["#a9d70b","#f9c802","#ff0000"];JustGage.prototype.generateShadow=function(i,a){var h=document.createElementNS(i,"filter");h.setAttribute("id",this.config.id+"-inner-shadow");a.appendChild(h);var g=document.createElementNS(i,"feOffset");g.setAttribute("dx",0);g.setAttribute("dy",this.config.shadowVerticalOffset);h.appendChild(g);var f=document.createElementNS(i,"feGaussianBlur");f.setAttribute("result","offset-blur");f.setAttribute("stdDeviation",this.config.shadowSize);h.appendChild(f);var b=document.createElementNS(i,"feComposite");b.setAttribute("operator","out");b.setAttribute("in","SourceGraphic");b.setAttribute("in2","offset-blur");b.setAttribute("result","inverse");h.appendChild(b);var e=document.createElementNS(i,"feFlood");e.setAttribute("flood-color","black");e.setAttribute("flood-opacity",this.config.shadowOpacity);e.setAttribute("result","color");h.appendChild(e);var c=document.createElementNS(i,"feComposite");c.setAttribute("operator","in");c.setAttribute("in","color");c.setAttribute("in2","inverse");c.setAttribute("result","shadow");h.appendChild(c);var d=document.createElementNS(i,"feComposite");d.setAttribute("operator","over");d.setAttribute("in","shadow");d.setAttribute("in2","SourceGraphic");h.appendChild(d);if(this.config.showInnerShadow==true){this.canvas.canvas.childNodes[2].setAttribute("filter","url(#"+this.config.id+"-inner-shadow)");this.canvas.canvas.childNodes[3].setAttribute("filter","url(#"+this.config.id+"-inner-shadow)")}};var getColorForPercentage=function(l,b,e){var k=b.length;if(k===1){return b[0]}var h=(e)?(1/(k-1)):(1/k);var d=new Array();for(var g=0;g<b.length;g++){var o=(e)?(h*g):(h*(g+1));var r=parseInt((cutHex(b[g])).substring(0,2),16);var f=parseInt((cutHex(b[g])).substring(2,4),16);var a=parseInt((cutHex(b[g])).substring(4,6),16);d[g]={pct:o,color:{r:r,g:f,b:a}}}if(l==0){return"rgb("+[d[0].color.r,d[0].color.g,d[0].color.b].join(",")+")"}for(var g=0;g<d.length;g++){if(l<=d[g].pct){if(e==true){var j=d[g-1];var s=d[g];var p=s.pct-j.pct;var q=(l-j.pct)/p;var m=1-q;var n=q;var c={r:Math.floor(j.color.r*m+s.color.r*n),g:Math.floor(j.color.g*m+s.color.g*n),b:Math.floor(j.color.b*m+s.color.b*n)};return"rgb("+[c.r,c.g,c.b].join(",")+")"}else{return"rgb("+[d[g].color.r,d[g].color.g,d[g].color.b].join(",")+")"}}}};function getRandomInt(b,a){return Math.floor(Math.random()*(a-b+1))+b}function cutHex(a){return(a.charAt(0)=="#")?a.substring(1,7):a}function getStyle(a,b){var c="";if(document.defaultView&&document.defaultView.getComputedStyle){c=document.defaultView.getComputedStyle(a,"").getPropertyValue(b)}else{if(a.currentStyle){b=b.replace(/\-(\w)/g,function(e,d){return d.toUpperCase()});c=a.currentStyle[b]}}return c}function onCreateElementNsReady(a){if(document.createElementNS!=undefined){a()}else{setTimeout(function(){onCreateElementNsReady(a)},100)}}var ie=(function(){var c,d=3,b=document.createElement("div"),a=b.getElementsByTagName("i");while(b.innerHTML="<!--[if gt IE "+(++d)+"]><i></i><![endif]-->",a[0]){}return d>4?d:c}());